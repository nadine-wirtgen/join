<section>
  <div class="headlineContainer">
    <div class="headline">
      <h1>Board</h1>
      <div class="addBtnMobil" (click)="openAddTaskDialog('todo')">
        <img src="assets/icon/task/board/add.png" />
      </div>
    </div>
    <div class="addBtnSearchContainer">
      <div class="searchSection">
        <textarea
          [(ngModel)]="searchTerm"
          (input)="filterTasks()"
          name="search"
          minlength="3"
          placeholder="Find Task"
          (mouseenter)="hoveredIcon = 'search'"
          (mouseleave)="hoveredIcon = null"
        ></textarea>
        <div class="lensArea">
          <img src="assets/icon/task/board/search-borderline.png" />
          <img
            [src]="
              hoveredIcon === 'search'
                ? 'assets/icon/task/board/search-hover.png'
                : 'assets/icon/task/board/search-default.png'
            "
          />
        </div>
      </div>
      <div class="addBtn" (click)="openAddTaskDialog('todo')">
        <p>Add Task</p>
        <img src="assets/icon/task/board/add.png" />
      </div>
    </div>
  </div>

  <div class="boardContainer">
    <div class="listContant">
      <div class="listHeadline">
        <p>To Do</p>
        <img
          (mouseenter)="hoveredIcon = 'addToDo'"
          (mouseleave)="hoveredIcon = null"
          [src]="
            hoveredIcon === 'addToDo'
              ? 'assets/icon/task/board/add-task-hover.png'
              : 'assets/icon/task/board/add-task-default.png'
          "
          (click)="openAddTaskDialog('todo')"
        />
      </div>
      <div
        class="listContainer"
        cdkDropList
        [id]="'todo'"
        [cdkDropListData]="tasks().todo"
        [cdkDropListConnectedTo]="connectedLists"
        (cdkDropListDropped)="drop($event)"
      >
        @if (tasks().todo.length > 0) {
          @for (task of tasks().todo; track task.id) {
            <div class="task-card" cdkDrag [cdkDragData]="task" (cdkDragMoved)="onDragMove($event)">
              <ng-template cdkDragPreview>
                <div class="preview-container">
                  <app-taskcard class="rotation-wrapper" [task]="task" />
                </div>
              </ng-template>

              <app-taskcard [task]="task" (openTask)="openTaskOverlay(task)" />
            </div>
          }
        } @else {
          <div class="placeholder">No tasks in progress</div>
        }
      </div>
    </div>

    <div class="listContant">
      <div class="listHeadline">
        <p>In progress</p>
        <img
          (mouseenter)="hoveredIcon = 'addProgress'"
          (mouseleave)="hoveredIcon = null"
          [src]="
            hoveredIcon === 'addProgress'
              ? 'assets/icon/task/board/add-task-hover.png'
              : 'assets/icon/task/board/add-task-default.png'
          "
          (click)="openAddTaskDialog('inProgress')"
        />
      </div>
      <div
        class="listContainer"
        cdkDropList
        [id]="'inProgress'"
        [cdkDropListData]="tasks().inProgress"
        [cdkDropListConnectedTo]="connectedLists"
        (cdkDropListDropped)="drop($event)"
      >
        @if (tasks().inProgress.length > 0) {
          @for (task of tasks().inProgress; track task.id) {
            <div class="task-card" cdkDrag [cdkDragData]="task" (cdkDragMoved)="onDragMove($event)">
              <ng-template cdkDragPreview>
                <div class="preview-container">
                  <app-taskcard class="rotation-wrapper" [task]="task" />
                </div>
              </ng-template>

              <app-taskcard [task]="task" (openTask)="openTaskOverlay(task)"></app-taskcard>
            </div>
          }
        } @else {
          <div class="placeholder">No tasks in progress</div>
        }
      </div>
    </div>

    <div class="listContant">
      <div class="listHeadline">
        <p>Await feedback</p>
        <img
          (mouseenter)="hoveredIcon = 'addAwait'"
          (mouseleave)="hoveredIcon = null"
          [src]="
            hoveredIcon === 'addAwait'
              ? 'assets/icon/task/board/add-task-hover.png'
              : 'assets/icon/task/board/add-task-default.png'
          "
          (click)="openAddTaskDialog('awaitFeedback')"
        />
      </div>
      <div
        class="listContainer"
        cdkDropList
        [id]="'awaitFeedback'"
        [cdkDropListData]="tasks().awaitFeedback"
        [cdkDropListConnectedTo]="connectedLists"
        (cdkDropListDropped)="drop($event)"
      >
        @if (tasks().awaitFeedback.length > 0) {
          @for (task of tasks().awaitFeedback; track task.id) {
            <div class="task-card" cdkDrag [cdkDragData]="task" (cdkDragMoved)="onDragMove($event)">
              <ng-template cdkDragPreview>
                <div class="preview-container">
                  <app-taskcard class="rotation-wrapper" [task]="task" />
                </div>
              </ng-template>

              <app-taskcard [task]="task" (openTask)="openTaskOverlay(task)"></app-taskcard>
            </div>
          }
        } @else {
          <div class="placeholder">No tasks in progress</div>
        }
      </div>
    </div>

    <div class="listContant listContantDone">
      <div class="listHeadline">
        <p>Done</p>
      </div>
      <div
        class="listContainer"
        cdkDropList
        [id]="'done'"
        [cdkDropListData]="tasks().done"
        [cdkDropListConnectedTo]="connectedLists"
        (cdkDropListDropped)="drop($event)"
      >
        @if (tasks().done.length > 0) {
          @for (task of tasks().done; track task.id) {
            <div class="task-card" cdkDrag [cdkDragData]="task" (cdkDragMoved)="onDragMove($event)">
              <ng-template cdkDragPreview>
                <div class="preview-container">
                  <app-taskcard class="rotation-wrapper" [task]="task" />
                </div>
              </ng-template>

              <app-taskcard [task]="task" (openTask)="openTaskOverlay(task)" />
            </div>
          }
        } @else {
          <div class="placeholder">No tasks in progress</div>
        }
      </div>
    </div>
  </div>
</section>

@if (showTaskOverlay && selectedTask) {
  <app-task-overlay
    [task]="selectedTask"
    (close)="closeTaskOverlay()"
    (save)="saveTask($event)"
    (delete)="deleteTask($event)"
  >
  </app-task-overlay>
}

@if (isAddTaskDialogOpen) {
  <app-add-task-dialog
    [column]="addTaskDialogColumn"
    (close)="closeAddTaskDialog()"
  ></app-add-task-dialog>
}
